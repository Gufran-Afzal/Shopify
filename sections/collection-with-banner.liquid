{%- liquid
  assign section_prefix_class = 'collection-with-banner'
  assign section_scheme_class = section.settings.section_color_scheme | prepend: 'scheme scheme--'

  capture container_class
    if section.settings.section_full_width
      echo 'container-fluid'
      else
        echo 'container'
    endif
  endcapture

  capture loading_attr
    unless section.index != 1
      echo 'eager'
      else
        echo 'lazy'
    endunless
  endcapture

  capture product_clean_url
    if section.settings.collection.product.url contains '?'
      assign parts = section.settings.collection.product.url | split: '?'
      echo parts[0]
      else
        echo section.settings.collection.product.url
    endif
  endcapture
-%}
{%- style -%}
  .collection-with-banner{
    --height-factor: 0.7;
    z-index: 1;
    text-align: var(--mobile-text-alignment);
    overflow: hidden;
  }

  .collection-with-banner .container{
    position: relative;
  }

  .collection-with-banner_bg-wrapper,
  .collection-with-banner_bg-wrapper::before{
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .collection-with-banner_bg-wrapper{
    z-index: -1;
    overflow: hidden;
  }

  .collection-with-banner_heading{
    --headings-font-weight: 400;
  }

  .collection-with-banner_bg-wrapper::before{
    content: '';
    background-image: var(--section-overlay);
    z-index: 2;
  }

  .collection-with-banner .splide__slide {
    padding-bottom: 1px;
  }

  .collection-with-banner .mty{
    --mt-bottom: var(--block-spacing);
  }

  .collection-with-banner_button{
    display: inline-flex;
    margin-left: 7px;
    margin-right: 7px;
  }

  .collection-with-banner_video{
    z-index: 1;
  }

  .collection-with-banner.--parallax-effect .collection-with-banner_image{
    background-attachment: fixed;
    background-position: 50% 50%;
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    background-size: cover;
  }

  .collection-with-banner_caption{
    display: block;
    line-height: 1.3;
    color: var(--section-foreground-color);
  }

  .collection-with-banner_bg-wrapper{
    transform: translateY(-220px);
  }

  .collection-with-banner_col-slideshow{
    padding-left: 40px;
    padding-right: 40px;
    position: relative;
    z-index: 9;
    background: var(--section-hotspot-glow-rgba-nill);
  }

  .collection-with-banner_col-slideshow .splide__arrows svg{
    width: 14px;
    height: 14px;
  }

  .collection-with-banner_col-slideshow .splide__arrow--next{
    position: absolute;
    top: -15px;
    bottom: 0;
    right: -22px;
    margin: auto;
    width: 45px;
    height: 45px;
    border-radius: 100%;
    border: none;
  }
  .collection-with-banner_description{
    color: var(--section-foreground-color);
  }
  .collection-with-banner_col-slideshow .splide__arrow--prev{
    position: absolute;
    top: -15px;
    bottom: 0;
    left: -22px;
    margin: auto;
    width: 45px;
    height: 45px;
    border-radius: 100%;
    border: none;
  }
  .collection-with-banner_wrapper{
    padding: 0 30px 30px;
  }
  .collection-with-banner .container-fluid,
  .collection-with-banner .container{
    padding-left: 0;
    padding-right: 0;
  }
  .collection-with-banner .product-card__main{
    height: 100%;
    background: var(--section-hotspot-glow-rgba-nill);
  }
  .card_media--landscape .product-card .product-card_media-wrap,
  .card_media--portrait .product-card .product-card_media-wrap{
    margin-top: 0;
    margin-bottom: 0;
  }
  .card_media--portrait .product-card,
  .card_media--landscape .product-card{
    height: 100%;
  }

  .product-card_heading{
    --mt-bottom: 10px;
  }
  
  .product-card_heading a{
    color: inherit;
    text-decoration: none;
  }
  .product-card_heading,
  .product-card_heading a,
  .product-card_vendor,
  .product-card_price{
    color: var(--section-heading-color);
  }

  .product-card .product-card_heading a:hover{
    color: var(--section-active-hover-color);
  }
  .product-card_heading,
  .product-card_heading a,
  .product-card_vendor,
  .product-card_price,
  .product-card_image{
    display: block;
  }
  
  .product-card,
  .product-card_top-wrap{
    display: flex;
    flex-direction: column;
  }
  
  .product-card_image,
  .product-card,
  .product-card_top-wrap{
    position: relative;
  }
  
  .product-card_top-wrap{
    flex-grow: 1;
  }
  
  .product-card,
  .product-card_tags-list{
    width: 100%;
  }
  
  .product-card_details-wrap{
    padding: 16px 16px;
  }
  .card_media--square .product-card_media-wrap{
    margin-top: 0;
    margin-bottom: 0;
  }
  .product-card_media-wrap{
    margin-top: auto;
    margin-bottom: auto;
    }
  
  a.product-card_image:focus-visible > img{
    border: 1px solid var(--section-focus-outline-color);
  }
  
  .product-card_vendor,
  .product-card_price{
    line-height: 1.2;
    margin-top: 10px;
  }
  
  .product-card_tags-list{
    position: absolute;
    bottom: 0;
    left: 0;
    padding: 24px 28px;
    pointer-events: none;
    gap: 9px;
  }
  .text-size--small a{
    line-height: 1.3;
  }
  .product-card{
    display: block;
    height: 100%;
    border: 1px solid var(--border-color, var(--section-border-color));
    padding: 10px;
    background-color: var(--section-background-color);
  }
  .product-card_details-wrap.widget--styles{
    background-color: var(--section-background-color);
  }

  @media (min-width: 768px){
    .collection-with-banner_bg-wrapper{
      transform: translateY(-200px);
    }
    .collection-with-banner{
      --height-factor: 0.85;
      text-align: var(--desktop-text-alignment);
    }
  }
  @media (min-width: 992px){
    .collection-with-banner_bg-wrapper{
      transform: translateY(-220px);
    }
  }
{%- endstyle -%}
<div class="global-block {{ section_prefix_class }} {{ section_prefix_class }}-{{ section.id }} {{ section_scheme_class }}" style="--desktop-text-alignment: {{ section.settings.section_text_alignment }}; --mobile-text-alignment: {{ section.settings.section_mobile_text_alignment }}; --section-padding-top: {{ section.settings.section_top_padding }}px; --section-padding-bottom: {{ section.settings.section_bottom_padding }}px;">
  <div  class="{{ container_class }}">
    <div class="{{ section_prefix_class }}_wrapper">
      {%- for block in section.blocks -%}
        {%- case block.type -%}
          {%- when 'heading' -%}
            <h2 class="{{ section_prefix_class }}_{{ block.type }} --word-break {{ block.type }} {{ block.settings.heading_size }} {{ block.settings.heading_weight }} --h-anchor-none mty" style="--block-spacing: {{ block.settings.block_spacing }}px;" {{ block.shopify_attributes }}>
              {{- block.settings.heading -}}
            </h2>
          {%- when 'description' -%}
            <div class="{{ section_prefix_class }}_{{ block.type }} --word-break {{ block.type }} {{ block.settings.description_weight }} {{ block.settings.description_size }} mty" style="--block-spacing: {{ block.settings.block_spacing }}px;" {{ block.shopify_attributes }}>
              {{- block.settings.heading -}}
            </div>
          {%- when 'caption' -%}
            <strong class="{{ section_prefix_class }}_{{ block.type }} --word-break {{ block.type }} {{ block.settings.caption_weight }} {{ block.settings.caption_size }} mty" style="--block-spacing: {{ block.settings.block_spacing }}px;" {{ block.shopify_attributes }}>
              {{- block.settings.heading -}}
            </strong>
        {%- endcase -%}
      {%- endfor -%}
    </div>
    <div class="{{ section_prefix_class }}_bg-wrapper">
      {%- if section.settings.image -%}
        {%- liquid
          assign section_banner_widths = '320, 412, 768, 992, 1260, 1350, 1440, 1640, 1920'
          assign section_banner_sizes = '100vw'
          assign section_banner_width = 1920
          unless section.settings.section_full_width
            assign section_banner_width = 1350
            assign section_banner_widths = '320, 412, 768, 992, 1230, 1350'
            assign section_banner_sizes = '(max-width: 1259px) 100vw, calc(var(--cp-width-px) - 0)'
          endunless

          capture image_alt
            unless section.settings.image.alt == blank
              echo section.settings.image.alt
              else
                echo section.settings.section_heading | escape
            endunless
          endcapture

          assign image_height = 320 | divided_by: section.settings.image.aspect_ratio | round
        -%}
        <div class="{{ section_prefix_class }}_image">
          {{- section.settings.image | image_url: width: section_banner_width | image_tag:
            class: 'object-fit object-fit--absolute',
            loading: loading_attr,
            widths: section_banner_widths,
            sizes: section_banner_sizes,
            width: 320,
            height: image_height,
            alt: image_alt
          -}}
        </div>
      {% else %}
        {{- 'hero-apparel-1' | placeholder_svg_tag: 'object-fit object-fit--absolute' -}}
      {%- endif -%}
    </div> 
    <div class="{{ section_prefix_class }}_col {{ section_prefix_class }}_col-slideshow">
      <splide-slider 
        data-slider-type="default"
      >
        <div class="splide"
          data-splide='{
            "drag": true,
            "autoplay": {{- section.settings.auto_play -}},
            "interval": {{- section.settings.change_slides_every | times: 1000 -}},
            "rewind": true,
            "pauseOnHover": true,
            "gap": "20px",
            "perMove": 1,
            "perPage": 1,
            "arrows": true,
            "pagination": false,
            "arrows": {{- section.settings.show_navigation -}},
            "mediaQuery": "min",
              "breakpoints": {
                "576": {
                  "perPage": {{ section.settings.number_of_columns_on_mobile }}
                },
                "768": {
                  "perPage": 3
                },
                "992": {
                  "perPage": 3
                },
                "1200": {
                  "perPage": {{ section.settings.number_of_columns_on_desktop }}
                }
              },
            {% if request.design_mode == false %}
              "type": "loop"
            {% else %}
              "type": "slide"
            {% endif %}
          }'>
          <div class="splide__track">
            <div class="splide__list splide-slider--h-scroll" style="--init-divider: {{ section.settings.number_of_columns_on_desktop }}; --init-mob-divider: {{ section.settings.number_of_columns_on_mobile }};">
              {%- if section.settings.collection != blank and section.settings.collection.products.size > 0 -%}
                {%- for product in section.settings.collection.products -%}
                  <div class="splide__slide card_media--{{ section.settings.product_media_size }}">
                    <div class="product-card__main {{ section_scheme_class }}">
                      {%- liquid
                        render 'product-card', product: product, heading_tag: 'h3', columns_count: section.settings.number_of_columns_on_desktop, media_size: section.settings.product_media_size, show_price: section.settings.show_price, show_vendor: section.settings.show_vendor, heading_size: section.settings.product_heading_size, heading_weight: section.settings.product_heading_weight
                      -%}
                    </div>
                  </div>
                {%- endfor -%}
              {%- else -%}
                {%- for index in (1..5) -%}
                  <div class="splide__slide card_media--{{ section.settings.product_media_size }}">
                    <div class="product-card__main {{ section_scheme_class }}">
                      <focused-element class="product-card product-card-placeholder">
                        <div class="product-card_top-wrap">
                          <div class="product-card_media-wrap">
                            <a 
                              {% unless section.settings.collection.product.title == blank %}href="{{- product_clean_url -}}"{% else %}aria-disabled="true"{% endunless %}
                              class="product-card_image --media-size-{{ section.settings.product_media_size }}" 
                              style="--media-ratio: 1;"
                            >
                              {{ 'product-apparel-1' | placeholder_svg_tag: 'object-fit object-fit--absolute' }}
                            </a>
                          </div>
                        </div>
                        <div class="product-card_details-wrap widget--styles --align-center">
                          <h2 class="mty {{ section.settings.product_heading_size }} {{ section.settings.product_heading_weight }} product-card_heading">
                            <a {% if product_clean_url != blank %} href="{{- product_clean_url -}}" {% endif %} class="--hover-underline">
                              {{- 'product.title' | t -}}
                            </a>
                          </h2>
                          {%- if section.settings.show_vendor == true -%}
                            <strong class="h text-size--small --fw-medium --word-break product-card_vendor">
                              {{- 'product.vendor_label' | t -}}
                            </strong>
                          {%- endif -%}
                          {%- if section.settings.show_price == true -%}
                            <strong class="--fw-normal text-size--small product-card_price">
                              {%- render 'product-price', product: product, use_variant: false, show_unit_price: true -%}
                            </strong>
                          {%- endif -%}
                        </div>
                      </focused-element>
                    </div>
                  </div> 
                {%- endfor -%}
              {%- endif -%}
            </div>
          </div>
          {%- if section.settings.show_navigation  -%}
            <div class="splide-controls splide__arrows --justify-center">
              {%- if section.settings.show_navigation -%}
                <button class="splide__arrow splide__arrow--prev button button--primary button--icn">
                  <span class="visually-hidden">{{ 'accessibility.slider.previous' | t }}</span>
                  {%- render 'icons-data', width: 10, height: 10, use_icon: true, icon_reference: 'left-arrow' -%}
                </button>
                <button class="splide__arrow splide__arrow--next button button--primary button--icn">
                  <span class="visually-hidden">{{ 'accessibility.slider.next' | t }}</span>
                  {%- render 'icons-data', width: 10, height: 10, use_icon: true, icon_reference: 'right-arrow' -%}
                </button>
              {%- endif -%}
            </div>
          {%- endif -%}
        </div>
      </splide-slider>
    </div>
  </div>
</div>
{% schema %}
{
  "name": "t:sections.banner_with_collection.name",
  "tag": "section",
  "disabled_on": {
    "groups": [
      "header",
      "footer",
      "custom.overlay"
    ]
  },
  "settings": [
    {
      "type": "image_picker",
      "id": "image",
      "label": "t:image.label",
      "info": "t:sections.image_banner.settings.image.info"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "t:sections.banner_with_collection.settings.collection_slider.label",
      "info": "t:sections.banner_with_collection.settings.collection_slider.info"
    },
    {
      "type": "header",
      "content": "t:product.card.content"
    },
    {
      "type": "select",
      "id": "product_media_size",
      "label": "t:media.label",
      "options": [
        {
          "value": "adapt",
          "label": "t:media.options.opt_1.label"
        },
        {
          "value": "square",
          "label": "t:media.options.opt_2.label"
        },
        {
          "value": "portrait",
          "label": "t:media.options.opt_3.label"
        },
        {
          "value": "landscape",
          "label": "t:media.options.opt_4.label"
        }
      ],
      "default": "square"
    },
    {
      "type": "select",
      "id": "product_heading_size",
      "label": "t:sizes.heading.label",
      "options": [
        {
          "value": "text-size--small",
          "label": "t:sizes.text.options.opt_1.label"
        },
        {
          "value": "text-size--medium",
          "label": "t:sizes.text.options.opt_2.label"
        },
        {
          "value": "text-size--large",
          "label": "t:sizes.text.options.opt_3.label"
        }
      ],
      "default": "text-size--small"
    },
    {
      "type": "select",
      "id": "product_heading_weight",
      "label": "t:weight.heading.label",
      "options": [
        {
          "value": "--fw-bold",
          "label": "t:weight.heading.options.opt_1.label"
        },
        {
          "value": "--fw-semi-bold",
          "label": "t:weight.heading.options.opt_5.label"
        },
        {
          "value": "--fw-medium",
          "label": "t:weight.heading.options.opt_2.label"
        },
        {
          "value": "--fw-normal",
          "label": "t:weight.heading.options.opt_3.label"
        },
        {
          "value": "--fw-light",
          "label": "t:weight.heading.options.opt_4.label"
        }
      ],
      "default": "--fw-semi-bold"
    },
    {
      "type": "checkbox",
      "id": "show_price",
      "label": "t:product.price.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "t:product.vendor.label",
      "default": false
    },
    {
      "type": "header",
      "content": "t:slideshow.content"
    },
    {
      "type": "checkbox",
      "id": "auto_play",
      "label": "t:slideshow.auto_play.label",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_navigation",
      "label": "t:slideshow.show_arrows.label",
      "default": true
    },
    {
      "type": "range",
      "id": "change_slides_every",
      "label": "t:slideshow.interval.label",
      "min": 2,
      "max": 9,
      "step": 1,
      "default": 5,
      "unit": "s",
      "info": "t:slideshow.interval.info"
    },
    {
      "type": "range",
      "id": "number_of_columns_on_desktop",
      "label": "t:grid.desktop.columns.label",
      "min": 2,
      "max": 4,
      "step": 1,
      "default": 4
    },
    {
      "type": "select",
      "id": "number_of_columns_on_mobile",
      "label": "t:grid.mobile.columns.label",
      "info": "t:grid.mobile.info_small",
      "options": [
        {
          "value": "1",
          "label": "t:grid.mobile.columns.options.opt_1.label"
        },
        {
          "value": "2",
          "label": "t:grid.mobile.columns.options.opt_2.label"
        }
      ],
      "default": "2"
    },
    {
      "type": "header",
      "content": "t:layout.content"
    },
    {
      "type": "checkbox",
      "id": "section_full_width",
      "label": "t:sections.full_width.label",
      "default": false
    },
    {
      "type": "text_alignment",
      "id": "section_text_alignment",
      "label": "t:alignments.text.desktop.label",
      "default": "center"
    },
    {
      "type": "text_alignment",
      "id": "section_mobile_text_alignment",
      "label": "t:alignments.text.mobile.label",
      "default": "center"
    },
    {
      "type": "color_scheme",
      "id": "section_color_scheme",
      "default": "scheme1",
      "label": "t:color_scheme.label"
    },
    {
      "type": "header",
      "content": "t:spacing.content"
    },
    {
      "type": "range",
      "id": "section_top_padding",
      "label": "t:spacing.settings.top.label",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 50,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "section_bottom_padding",
      "label": "t:spacing.settings.bottom.label",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 33,
      "unit": "px"
    }
  ],
  "blocks": [
    {
      "name": "t:heading.name",
      "type": "heading",
      "settings": [
        {
          "type": "inline_richtext",
          "id": "heading",
          "label": "t:heading.label",
          "default": "t:sections.banner_with_collection.blocks.banner_heading.settings.heading.label"
        },
        {
          "type": "select",
          "id": "heading_size",
          "label": "t:sizes.heading.label",
          "options": [
            {
              "value": "h1",
              "label": "t:sizes.heading.options.opt_1.label"
            },
            {
              "value": "h2",
              "label": "t:sizes.heading.options.opt_2.label"
            },
            {
              "value": "h3",
              "label": "t:sizes.heading.options.opt_3.label"
            },
            {
              "value": "h4",
              "label": "t:sizes.heading.options.opt_4.label"
            }
          ],
          "default": "h3"
        },
        {
          "type": "select",
          "id": "heading_weight",
          "label": "t:weight.heading.label",
          "options": [
            {
              "value": "--fw-bold",
              "label": "t:weight.heading.options.opt_1.label"
            },
            {
              "value": "--fw-semi-bold",
              "label": "t:weight.heading.options.opt_5.label"
            },
            {
              "value": "--fw-medium",
              "label": "t:weight.heading.options.opt_2.label"
            },
            {
              "value": "--fw-normal",
              "label": "t:weight.heading.options.opt_3.label"
            } 
          ],
          "default": "--fw-bold"
        },
        {
          "type": "range",
          "id": "block_spacing",
          "label": "t:bottom_margin.label",
          "min": 0,
          "max": 50,
          "step": 1,
          "default": 10,
          "unit": "px"
        }
      ]
    },
    {
      "name": "t:description_text.name",
      "type": "description",
      "settings": [
        {
          "type": "inline_richtext",
          "id": "heading",
          "label": "t:description_text.label",
          "default": "t:sections.banner_with_collection.blocks.description.settings.description_text.label"
        },
        {
          "type": "select",
          "id": "description_size",
          "label": "t:sizes.description_text.label",
          "options": [
            {
              "value": "text-size--small",
              "label": "t:sizes.text.options.opt_1.label"
            },
            {
              "value": "text-size--medium",
              "label": "t:sizes.text.options.opt_2.label"
            },
            {
              "value": "text-size--large",
              "label": "t:sizes.text.options.opt_3.label"
            },
            {
              "value": "text-size--xlarge",
              "label": "t:sizes.text.options.opt_4.label"
            }
          ],
          "default": "text-size--medium"
        },
        {
          "type": "select",
          "id": "description_weight",
          "label": "t:weight.description_text.label",
          "options": [
            {
              "value": "--fw-bold",
              "label": "t:weight.heading.options.opt_1.label"
            },
            {
              "value": "--fw-semi-bold",
              "label": "t:weight.heading.options.opt_5.label"
            },
            {
              "value": "--fw-medium",
              "label": "t:weight.heading.options.opt_2.label"
            },
            {
              "value": "--fw-normal",
              "label": "t:weight.heading.options.opt_3.label"
            },
            {
              "value": "--fw-light",
              "label": "t:weight.heading.options.opt_4.label"
            }
          ],
          "default": "--fw-normal"
        },
        {
          "type": "range",
          "id": "block_spacing",
          "label": "t:bottom_margin.label",
          "min": 0,
          "max": 50,
          "step": 1,
          "default": 10,
          "unit": "px"
        }
      ]
    },
    {
      "name": "t:caption.name",
      "type": "caption",
      "limit": 3,
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "t:caption.label",
          "default": "t:sections.banner_with_collection.blocks.banner_caption.settings.caption_title.label"
        },
        {
          "type": "select",
          "id": "caption_size",
          "label": "t:sizes.caption.label",
          "options": [
            {
              "value": "text-size--small",
              "label": "t:sizes.text.options.opt_1.label"
            },
            {
              "value": "text-size--medium",
              "label": "t:sizes.text.options.opt_2.label"
            },
            {
              "value": "text-size--large",
              "label": "t:sizes.text.options.opt_3.label"
            },
            {
              "value": "text-size--xlarge",
              "label": "t:sizes.text.options.opt_4.label"
            }
          ],
          "default": "text-size--small"
        },
        {
          "type": "select",
          "id": "caption_weight",
          "label": "t:weight.caption.label",
          "options": [
            {
              "value": "--fw-bold",
              "label": "t:weight.heading.options.opt_1.label"
            },
            {
              "value": "--fw-semi-bold",
              "label": "t:weight.heading.options.opt_5.label"
            },
            {
              "value": "--fw-medium",
              "label": "t:weight.heading.options.opt_2.label"
            },
            {
              "value": "--fw-normal",
              "label": "t:weight.heading.options.opt_3.label"
            }
          ],
          "default": "--fw-normal"
        },
        {
          "type": "range",
          "id": "block_spacing",
          "label": "t:bottom_margin.label",
          "min": 0,
          "max": 50,
          "step": 1,
          "default": 10,
          "unit": "px"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.banner_with_collection.name",
      "blocks": [
        {
          "type": "caption",
          "settings": {
          }
        },
        {
          "type": "heading",
          "settings": {
          }
        },
        {
          "type": "description",
          "settings": {
          }
        }
      ]
    }
  ]
}
{% endschema %}